<!DOCTYPE html><html lang="en"><head> <%- include('../../components/head'); %> <title>Studors - Student</title><script charset="utf8"src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script><script charset="utf8"src="/js/pickadate.min.js"></script><link rel="stylesheet"type="text/css"href="/css/pickadate.min.css"><style>input,select{font-size:16pt;width:230px;padding-left:0;padding-right:0}input{width:226px}.maincontent{text-align:center;margin-top:100px}.centerselect{text-align:left;width:fit-content;margin-left:auto;margin-right:auto;line-height:1.4}.centerbuttons{text-align:center}#subjectpicker{margin-left:20px}@media(max-width:600px){.maincontent{margin-top:10px}.centerselect{text-align:center;line-height:1}#subjectpicker{margin-left:0}}</style> <%- include('../../components/header'); %> <div class="maincontent"><div class="centerselect"><form onsubmit="return validate(this)"action=""method="post"><h1 style="display:inline">Select a subject: <select id="subjectpicker"name="subjectpicker"onchange="subjectUpdated(),remove(0)"><option></option> <% for (const obj of subjects) { %> <option value="<%= obj['subject'] %>"><%= obj['subject'] %></option> <% } %> </select></h1><br><span id="noTutorError"class="small-info"style="display:none">Sorry, there are currently no tutors for this subject.<br class="hidemobile">Please contact the tutoring chair for further assistance.<br></span><h1 id="tutorcontainer"style="display:none">Select a tutor: <select id="tutorpicker"name="tutorpicker"onchange="tutorUpdated(),remove(0)"><option>Any</select><br></h1><h1 id="datecontainer"style="display:none">Select a date: <input id="datepicker"onchange="dateUpdated(),remove(1)"><br></h1><h1 id="timecontainer"style="display:none">Select a time: <input id="timepicker"onchange="timeUpdated()"><br></h1><h1 id="durationcontainer"style="display:none">Select a duration: <select id="durationpicker"name="durationpicker"></select><br></h1><br><div class="centerbuttons"><button class="mainbutton"type="submit"style="left:0;transform:none;display:none"id="sched">Schedule</button> <button class="mainbutton"type="button"style="left:0;transform:none"onclick='window.location.replace("/student/home")'value="Cancel">Cancel</button></div><br><span class="small-error"><%= error %></span><input type="hidden"id="time"name="time"></form></div></div> <%- include('../../components/footer'); %> <script>var selectedDate,selectedTime,selectedDateTime,serverOffset= <%- new Date(Date.now()).getTimezoneOffset() %>,clientOffset=new Date(Date.now()).getTimezoneOffset(),$time=$("#timepicker").pickatime({interval:15}),timepicker=$time.pickatime("picker"),$date=$("#datepicker").pickadate({today:""}),datepicker=$date.pickadate("picker"),duration=document.querySelector("#duration"),sessions= <%- JSON.stringify(availability) %>,validSessions=[],availableDays=[],uniqueTutors=[],generatedTutor="",selectedSubject="",selectedTutor="Any";function validate(){return""!=document.getElementById("subjectpicker").value&&15<=document.getElementById("durationpicker").value&&""!=document.getElementById("time").value&&("Any"===document.getElementById("tutorpicker").value&&(document.getElementById("tutorpicker").value=generatedTutor),!0)}function subjectUpdated(){""===subjectpicker.options[0].value&&subjectpicker.remove(0),validSessions=[],selectedSubject=document.getElementById("subjectpicker").value;for(var e=0;e<sessions.length;e++)sessions[e].subject_id===selectedSubject&&validSessions.push(sessions[e]);tutorSetup()}function tutorSetup(){uniqueTutors=[];for(var t=0;t<validSessions.length;t++)uniqueTutors.some(e=>e.tutor_id===validSessions[t].tutor_id)||uniqueTutors.push(validSessions[t]);for(;1<tutorpicker.options.length;)tutorpicker.remove(1);if(console.log(uniqueTutors),0===uniqueTutors.length)document.getElementById("noTutorError").style.display="inline",document.getElementById("tutorcontainer").style.display="none",document.getElementById("datecontainer").style.display="none",document.getElementById("timecontainer").style.display="none",document.getElementById("durationcontainer").style.display="none",document.getElementById("sched").style.display="none";else{for(t=0;t<uniqueTutors.length;t++){var e=new Option(uniqueTutors[t].first_name+" "+uniqueTutors[t].last_name,uniqueTutors[t].tutor_id);tutorpicker.add(e,void 0)}document.getElementById("tutorcontainer").style.display="inline",document.getElementById("noTutorError").style.display="none",dateSetup()}}function tutorUpdated(){selectedTutor=document.getElementById("tutorpicker").value,dateSetup()}function dateSetup(){document.getElementById("datecontainer").style.display="inline",availableDays=[];for(var e=0;e<validSessions.length;e++)"Any"!==selectedTutor&&validSessions[e].tutor_id!==selectedTutor||availableDays.push(new Date(validSessions[e].time_id));datepicker.set("disable",!0),datepicker.set("enable",!1),datepicker.set("disable",availableDays),datepicker.set("disable","flip"),datepicker.set("enable","flip")}function dateUpdated(){""===datepicker.get()?selectedDate=null:(selectedDate=datepicker.get("select").obj,timeSetup())}function timeSetup(){document.getElementById("timecontainer").style.display="inline";for(var e=[],t=0;t<availableDays.length;t++){var i=new Date(availableDays[t]);i.setHours(0,0,0,0),i.getTime()===selectedDate.getTime()&&((i=new Date(availableDays[t])).setHours(availableDays[t].getHours()+(clientOffset/60-serverOffset/60)),e.push(i))}timepicker.set("disable",!0),timepicker.set("enable",!1),timepicker.set("disable",e),timepicker.set("disable","flip"),timepicker.set("enable","flip")}function timeUpdated(){""===timepicker.get()?(selectedTime=null,document.getElementById("time").value=null):(selectedTime=timepicker.get("select"),(selectedDateTime=new Date(selectedDate)).setHours(selectedTime.hour-(clientOffset/60-serverOffset/60),selectedTime.mins),document.getElementById("time").value=selectedDateTime,durationSetup())}function durationSetup(){document.getElementById("durationcontainer").style.display="inline";for(var e,t=[],i=[],n=!(document.getElementById("sched").style.display="inline"),s=0;s<validSessions.length;s++)"Any"!==selectedTutor&&validSessions[s].tutor_id!==selectedTutor||(validSessions[s].tutor_id!=e||n?(i.length<t.length&&(generatedTutor=e,i=t),t=[],selectedDateTime.getTime()===new Date(validSessions[s].time_id).getTime()&&(e=validSessions[s].tutor_id,t.push(validSessions[s].time_id))):new Date(validSessions[s].time_id).getTime()-new Date(validSessions[s-1].time_id).getTime()==9e5?t.push(validSessions[s].time_id):n=!0);for(i.length<t.length&&(generatedTutor=e,i=t);0<durationpicker.options.length;)durationpicker.remove(0);for(s=1;s-1<i.length;s++){var d=new Option(15*s+" Minutes",15*s);durationpicker.add(d,void 0)}}function remove(e){for(;e<3;e++)switch(e){case 0:""!=datepicker.get()&&datepicker.clear(),document.getElementById("timecontainer").style.display="none";case 1:""!=timepicker.get()&&timepicker.clear(),document.getElementById("durationcontainer").style.display="none";case 2:for(;0<durationpicker.options.length;)durationpicker.remove(0)}}</script>